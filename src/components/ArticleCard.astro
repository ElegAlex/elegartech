---
import type { CollectionEntry } from 'astro:content';
import CategoryBadge from './CategoryBadge.astro';

interface Props {
  post: CollectionEntry<'blog'>;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const { title, description, date, categories, tags, cover, difficulty } = post.data;

const formattedDate = new Intl.DateTimeFormat('fr-FR', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
}).format(date);

const readingTime = Math.ceil(post.body.split(/\s+/).length / 200);
const slug = post.slug;
---

<article class={`article-card rounded-xl overflow-hidden bg-[var(--bg-secondary)] border border-[var(--code-border)] ${featured ? 'md:col-span-2 md:grid md:grid-cols-2' : ''}`}>
  {cover && (
    <a href={`/blog/${slug}`} class="block overflow-hidden">
      <img
        src={cover.image.src}
        alt={cover.alt}
        class={`w-full object-cover transition-transform duration-300 hover:scale-105 ${featured ? 'h-full' : 'h-48'}`}
        loading="lazy"
      />
    </a>
  )}

  <div class="p-5">
    <div class="flex flex-wrap items-center gap-2 mb-3">
      {categories.map((cat) => <CategoryBadge category={cat} size="sm" />)}
      {difficulty && (
        <span class="difficulty-badge text-xs" data-level={difficulty}>
          {difficulty}
        </span>
      )}
    </div>

    <a href={`/blog/${slug}`} class="group">
      <h2 class={`font-bold mb-2 group-hover:text-[var(--accent-primary)] transition-colors ${featured ? 'text-2xl' : 'text-lg'}`}>
        {title}
      </h2>
    </a>

    <p class="text-sm text-[var(--text-secondary)] mb-4 line-clamp-2">
      {description}
    </p>

    <div class="flex items-center justify-between text-xs text-[var(--text-muted)]">
      <time datetime={date.toISOString()}>{formattedDate}</time>
      <span>{readingTime} min</span>
    </div>

    {tags.length > 0 && (
      <div class="flex flex-wrap gap-1.5 mt-3">
        {tags.slice(0, 3).map((tag) => (
          <a href={`/tags/${tag}`} class="tag">
            #{tag}
          </a>
        ))}
      </div>
    )}
  </div>
</article>
